<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notopia - Notes Sharing Portal</title>
  <link rel="icon" href="../EB.png" type="image/png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #FACC15;
      --primary-dark: #EAB308;
      --accent: #EA580C;
      --accent-dark: #C2410C;
      --bg-primary: #d7d3a1;
      --bg-secondary: #FEF08A;
      --text-primary: #78350F;
      --text-secondary: #92400E;
      --navbar-bg: #F59E0B;
      --navbar-text: #78350F;
      --border-color: #FCD34D;
      --shadow-color: rgba(234, 88, 12, 0.2);
      --hover-color: #FEF08A;
      --card-bg: rgba(255, 255, 255, 0.9);
    }
    [data-theme="dark"] {
      --primary: #F59E0B;
      --primary-dark: #D97706;
      --accent: #EA580C;
      --accent-dark: #9A3412;
      --bg-primary: #1E1E1E;
      --bg-secondary: #2E2E2E;
      --text-primary: #FEF3C7;
      --text-secondary: #FCD34D;
      --navbar-bg: #0F0F0F;
      --navbar-text: #FEF3C7;
      --border-color: #444;
      --shadow-color: rgba(234, 88, 12, 0.4);
      --hover-color: #2E2E2E;
      --card-bg: rgba(30, 30, 30, 0.9);
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
      transition: background-color 0.3s, color 0.3s;
    }
    body {
      background-color: var(--bg-primary);
      background-image: radial-gradient(circle at 10% 20%, var(--bg-secondary) 0%, var(--bg-primary) 90%);
      min-height: 100vh;
      color: var(--text-primary);
      transition: all 0.3s ease;
      overflow-x: hidden;
      position: relative;
    }
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 0;
      pointer-events: none;
      overflow: hidden;
    }
    .particle {
      position: absolute;
      background: var(--primary);
      border-radius: 50%;
      opacity: 0.3;
      animation: float linear infinite;
    }
    @keyframes float {
      0% { transform: translateY(0) rotate(0deg);}
      100% { transform: translateY(-100vh) rotate(360deg);}
    }
    .main-container {
      display: flex;
      min-height: 100vh;
      position: relative;
      z-index: 1;
      background: transparent;
    }
    .sidebar {
      width: 220px;
      background: var(--navbar-bg);
      color: var(--navbar-text);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px 0 0 0;
      box-shadow: 2px 0 10px var(--shadow-color);
      min-height: 100vh;
      z-index: 2;
    }
    .sidebar .logo {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .sidebar .user-info {
      margin-top: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    .sidebar .user-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: var(--primary);
      color: var(--navbar-text);
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    .sidebar .sidebar-links {
      margin-top: 40px;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
    }
    .sidebar .sidebar-links button {
      width: 180px;
      background: var(--accent);
      color: #fff;
      border: none;
      padding: 10px 0;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      margin-bottom: 8px;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .sidebar .sidebar-links button:hover {
      background: var(--accent-dark);
    }
    .sidebar .semester-dropdown-container {
      margin: 30px 0 0 0;
      width: 180px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 6px;
    }
    .sidebar .semester-dropdown {
      width: 100%;
      background: var(--card-bg);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 6px var(--shadow-color);
      outline: none;
    }
    .sidebar .semester-dropdown:disabled {
      background: var(--primary-dark);
      color: var(--text-primary);
      cursor: not-allowed;
      opacity: 0.7;
    }
    .content-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      z-index: 1;
      position: relative;
    }
    .navbar {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      background: transparent;
      color: var(--navbar-text);
      padding: 18px 30px 0 30px;
      min-height: 60px;
      gap: 20px;
    }
    .navbar .chatbot-toggle,
    .navbar .theme-toggle {
      background: var(--primary);
      color: var(--navbar-text);
      border: none;
      font-size: 18px;
      cursor: pointer;
      padding: 8px 16px;
      border-radius: 20px;
      transition: background-color 0.3s;
      margin-left: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .navbar .chatbot-toggle:hover,
    .navbar .theme-toggle:hover {
      background: var(--primary-dark);
    }
    .banner {
      width: 100%;
      height: 120px;
      background: var(--primary);
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      border-bottom: 2px solid var(--border-color);
      margin-bottom: 10px;
      border-radius: 0 0 18px 18px;
      box-shadow: 0 2px 10px var(--shadow-color);
    }
    .banner-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(rgba(250,204,21,0.2), rgba(234,88,12,0.2));
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      color: var(--text-primary);
      text-align: center;
    }
    .banner-title {
      font-size: 2.2rem;
      font-weight: bold;
      margin-bottom: 6px;
      text-shadow: 1px 1px 2px rgba(234,88,12,0.08);
    }
    .banner-subtitle {
      font-size: 1.1rem;
      max-width: 600px;
      text-shadow: 1px 1px 2px rgba(234,88,12,0.08);
    }
    .content-area {
      flex: 1;
      padding: 40px 40px 0 40px;
      overflow-y: auto;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 32px;
      width: 100%;
      max-width: 1100px;
      margin: 0 auto 30px auto;
    }
    .card, .dropdown .card {
      height: 140px;
      background: var(--card-bg);
      color: var (--text-primary);
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
      box-shadow: 0px 4px 12px var(--shadow-color);
      position: relative;
      overflow: hidden;
      padding: 20px;
      border: 1px solid var(--border-color);
    }
    .card:hover {
      background: var(--hover-color);
      transform: translateY(-5px) scale(1.03);
      box-shadow: 0 8px 20px var(--shadow-color);
    }
    .card-icon {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 24px;
      opacity: 0.7;
      color: var(--accent);
    }
    .dropdown {
      position: relative;
    }
    .dropdown-content {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      background: var(--card-bg);
      box-shadow: 0px 4px 12px var(--shadow-color);
      border-radius: 10px;
      display: none;
      flex-direction: column;
      z-index: 10;
      margin-top: 5px;
      overflow: hidden;
    }
    .dropdown:hover .dropdown-content {
      display: flex;
    }
    .dropdown-content div {
      padding: 12px;
      background: var(--card-bg);
      border-bottom: 1px solid var(--border-color);
      cursor: pointer;
      transition: 0.3s;
      color: var(--text-primary);
    }
    .dropdown-content div:hover {
      background: var(--hover-color);
    }
    .subject-container {
      display: none;
      margin-top: 20px;
      padding: 20px;
      background: var(--card-bg);
      box-shadow: 0px 4px 12px var(--shadow-color);
      border-radius: 10px;
      max-width: 800px;
      margin: 20px auto;
      color: var(--text-primary);
    }
    .subject-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
    }
    .subject-meta {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }
    .meta-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .meta-item i {
      color: var(--accent);
    }
    .upload-area {
      background: var(--bg-secondary);
      border: 2px dashed var(--border-color);
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      margin-bottom: 20px;
      cursor: pointer;
      transition: 0.3s;
    }
    .upload-area:hover {
      border-color: var(--accent);
    }
    .upload-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      transition: 0.3s;
      font-weight: bold;
      margin-top: 10px;
    }
    .upload-btn:hover {
      background: var(--accent-dark);
    }
    .note-list {
      margin-top: 20px;
    }
    .note-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--bg-primary);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      transition: 0.3s;
      border: 1px solid var(--border-color);
    }
    .note-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px var(--shadow-color);
      background: var(--hover-color);
    }
    .note-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .note-icon {
      font-size: 24px;
      color: var(--accent);
    }
    .note-actions {
      display: flex;
      gap: 10px;
    }
    .note-btn {
      background: var(--card-bg);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      transition: 0.3s;
      display: flex;
      align-items: center;
      gap: 5px;
      font-weight: 500;
    }
    .note-btn:hover {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    .note-btn i {
      font-size: 14px;
    }
    .toggle-chatbot {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: var(--accent);
      color: white;
      border: none;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 4px 8px var(--shadow-color);
      z-index: 1001;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    .toggle-chatbot:hover {
      background: var(--accent-dark);
      transform: scale(1.05);
    }
    /* Chatbot panel slide-in/out */
    .chatbot-panel {
      position: fixed;
      top: 0;
      right: -420px;
      width: 420px;
      height: 100vh;
      background: var(--card-bg);
      box-shadow: -5px 0 15px var(--shadow-color);
      border-left: 2px solid var(--border-color);
      display: flex;
      flex-direction: column;
      z-index: 2000;
      transition: right 0.35s cubic-bezier(.77,0,.18,1);
    }
    .chatbot-panel.open {
      right: 0;
    }
    .chatbot-header {
      background: var(--accent);
      color: white;
      padding: 20px;
      text-align: center;
      font-weight: bold;
      font-size: 18px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .close-chatbot {
      background: none;
      border: none;
      color: white;
      font-size: 18px;
      cursor: pointer;
    }
    .chatbox {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .message {
      max-width: 85%;
      padding: 10px 15px;
      border-radius: 18px;
      margin-bottom: 5px;
      word-wrap: break-word;
    }
    .bot-message {
      background: var(--bg-primary);
      color: var(--text-primary);
      border-top-left-radius: 5px;
      align-self: flex-start;
    }
    .user-message {
      background: var(--accent);
      color: white;
      border-top-right-radius: 5px;
      align-self: flex-end;
    }
    .chat-input-container {
      display: flex;
      padding: 15px;
      border-top: 1px solid var(--border-color);
      background: var(--bg-secondary);
    }
    .chat-input {
      flex: 1;
      padding: 12px;
      border: 1px solid var(--border-color);
      border-radius: 20px;
      background: var(--bg-primary);
      color: var(--text-primary);
      outline: none;
    }
    .chat-input:focus {
      border-color: var(--accent);
    }
    .send-btn {
      background: var(--accent);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-left: 10px;
      cursor: pointer;
      transition: 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .send-btn:hover {
      background: var(--accent-dark);
    }
    /* Responsive adjustments */
    @media (max-width: 1200px) {
      .container {
        grid-template-columns: 1fr 1fr;
      }
      .sidebar {
        width: 160px;
      }
      .sidebar .sidebar-links button, .sidebar .semester-dropdown {
        width: 120px;
      }
    }
    @media (max-width: 900px) {
      .main-container {
        flex-direction: column;
      }
      .sidebar {
        flex-direction: row;
        width: 100vw;
        height: auto;
        min-height: unset;
        padding: 10px 0;
        box-shadow: none;
        border-radius: 0;
      }
      .sidebar .sidebar-links {
        flex-direction: row;
        gap: 8px;
        margin-top: 0;
      }
      .sidebar .semester-dropdown-container {
        margin: 0 0 0 20px;
        flex-direction: row;
        gap: 8px;
      }
      .content-wrapper {
        padding-left: 0;
      }
      .content-area {
        padding: 20px 10px 0 10px;
      }
      .container {
        grid-template-columns: 1fr;
      }
    }
    @media (max-width: 600px) {
      .sidebar {
        flex-direction: column;
        width: 100vw;
        align-items: flex-start;
        padding: 10px 10px 0 10px;
      }
      .sidebar .sidebar-links button, .sidebar .semester-dropdown {
        width: 100%;
      }
      .banner {
        height: 80px;
      }
      .banner-title {
        font-size: 1.5rem;
      }
      .banner-subtitle {
        font-size: 1rem;
      }
      .content-area {
        padding: 10px 2vw 0 2vw;
      }
    }
  </style>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4D4980H5FQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-4D4980H5FQ');
</script>

</head>
<body>
  <div class="particles" id="particles"></div>
  <div class="main-container">
    <div class="sidebar">
      <div class="logo" style="display: flex; flex-direction: column; align-items: center;">
        <img src="../EB.png" alt="Notopia Logo" style="width:200px;height:200px;margin-bottom:18px;">
        <div style="text-align:center;font-size:24px;font-weight:bold;">Notopia</div>
      </div>
      <div class="user-info">
        <div class="user-avatar" id="user-avatar">U</div>
        <span id="user-role">Student</span>
        <button class="sidebar-logout sidebar-links button" onclick="logout()" style="margin-top:8px;width:100px;background:var(--accent-dark);color:#fff;"><i class="fas fa-sign-out-alt"></i> Logout</button>
      </div>
      <div class="sidebar-links">
        <button onclick="window.open('https://docs.google.com/forms/d/1IHFMc2QhMC8ecX911cGl7z7rvY1lV713Z02sEnd1bIE/edit?ts=6817a802', '_blank')">
          <i class="fas fa-comment-alt"></i> Feedback
        </button>
        <button onclick="window.location.href='studyzone.html'">
          <i class="fas fa-brain"></i> Study Zone
        </button>
      </div>
      <div class="semester-dropdown-container">
        <label for="semester-dropdown" style="font-weight:600;">Semester:</label>
        <select id="semester-dropdown" class="semester-dropdown" onchange="onSemesterChange(this)">
          <option value="semester1.html">Semester 1</option>
          <option value="semester2.html">Semester 2</option>
          <option value="semester3.html">Semester 3</option>
          <option value="semester4.html">Semester 4</option>
          <option value="semester5.html">Semester 5</option>
          <option value="semester6.html" selected disabled>Semester 6</option>
          <option value="semester7.html">Semester 7</option>
          <option value="semester8.html">Semester 8</option>
        </select>
      </div>
    </div>
    <div class="content-wrapper">
      <div class="navbar">
        <button id="theme-toggle" class="theme-toggle">
          <i class="fas fa-moon"></i>
        </button>
        <button id="chatbot-toggle-nav" class="chatbot-toggle">
          <i class="fas fa-robot"></i>
          Assistant
        </button>
      </div>
      <div class="banner">
        <div class="banner-overlay">
          <div class="banner-title">Notopia - Notes Sharing Portal</div>
          <div class="banner-subtitle">Collaborate, Share, and Learn Together</div>
        </div>
      </div>
      <div class="content-area">
        <div class="container">
          <div class="card" onclick="openSubject('Software Engineering', '19CSE314', 3)">
            <i class="fas fa-code card-icon"></i>
            Software Engineering
          </div>
          <div class="card" onclick="openSubject('Principles of Programming Language', '19CSE313', 3)">
            <i class="fas fa-laptop-code card-icon"></i>
            Principles of Programming Language
          </div>
          <div class="card" onclick="openSubject('Distributed Systems', '19CSE312', 4)">
            <i class="fas fa-network-wired card-icon"></i>
            Distributed Systems
          </div>
          <div class="card" onclick="openSubject('Computer Security', '19CSE311', 3)">
            <i class="fas fa-shield-alt card-icon"></i>
            Computer Security
          </div>
  
          <div class="dropdown">
            <div class="card">
              <i class="fas fa-puzzle-piece card-icon"></i>
              Professional Elective 2
            </div>
            <div class="dropdown-content">
              <div onclick="openSubject('Ethical Hacking', '19CSE335', 3)">
                <i class="fas fa-user-secret"></i> Ethical Hacking
              </div>
              <div onclick="openSubject('Deep Learning for Computer Vision', '19CSE437', 3)">
                <i class="fas fa-eye"></i> Deep Learning for Computer Vision
              </div>
              <div onclick="openSubject('Cloud Computing', '19CSE445', 3)">
                <i class="fas fa-cloud"></i> Cloud Computing
              </div>
            </div>
          </div>
  
          <div class="dropdown">
            <div class="card">
              <i class="fas fa-puzzle-piece card-icon"></i>
              Professional Elective 3
            </div>
            <div class="dropdown-content">
              <div onclick="openSubject('Mobile and Wireless Security', '19CSE338', 3)">
                <i class="fas fa-mobile-alt"></i> Mobile and Wireless Security
              </div>
              <div onclick="openSubject('Internet of Things', '19CSE446', 3)">
                <i class="fas fa-microchip"></i> Internet of Things
              </div>
              <div onclick="openSubject('Neural Networks and Deep Learning', '19CSE456', 3)">
                <i class="fas fa-brain"></i> Neural Networks and Deep Learning
              </div>
              <div onclick="openSubject('Time Series Analysis', '22AIE463', 3)">
                <i class="fas fa-chart-line"></i> Time Series Analysis
              </div>       
            </div>
          </div>        
        </div>
     
        
        
        
        
        <h2 style="margin: 30px 0 10px 0; font-size: 24px; text-align: left; width:100%; max-width:1100px;">ðŸ“… My Calendar</h2>
        <div style="width: 100%; display: flex; justify-content: flex-start; max-width:1100px;">
          <iframe
            src="https://calendar.google.com/calendar/embed?src=ab2507bf49c7c891c61e96340d4a4f2fae2ac83d7f25b005e480bb77b787f128%40group.calendar.google.com&ctz=Asia%2FKolkata&mode=MONTH&showTitle=0&showNav=1&showDate=1&showPrint=0&showTabs=0&showCalendars=0&showTz=0"
            style="border: 1px solid #ccc;"
            width="600"
            height="300"
            frameborder="0"
            scrolling="no">
          </iframe>
        </div>
        <button id="start-quiz-btn" onclick="renderModernQuiz()" style="display: none; margin-top: 20px;">Start Quiz</button>
        <div id="quiz-container" style="margin-top: 20px;"></div>
        <div id="subject-container" class="subject-container">
          <div class="subject-header">
            <h2 id="subject-title"></h2>
            <button class="note-btn" id="back-btn" onclick="closeSubject()">
              <i class="fas fa-arrow-left"></i> Back 
            </button>
          </div>
          
          <div class="subject-meta">
            <div class="meta-item">
              <i class="fas fa-bookmark"></i>
              <span id="course-code"></span>
            </div>
            <div class="meta-item">
              <i class="fas fa-star"></i>
              <span id="course-credits"></span> Credits
            </div>
          </div>
  
          <div id="upload-area" style="display: none;">
            <a id="open-drive" class="upload-btn" href="#" target="_blank" rel="noopener noreferrer">
              <i class="fas fa-upload"></i> Manage Drive
            </a>
          </div>
  
          <h3><i class="fas fa-list-ul"></i> Available Notes</h3>
          <div class="note-list" id="note-list"></div>
        </div>
      </div>
    </div>
  </div>
  <button class="toggle-chatbot" id="toggle-chatbot">
    <i class="fas fa-comment"></i>
  </button>
  <div class="chatbot-panel" id="chatbot-panel">
    <div class="chatbot-header">
      <span><i class="fas fa-robot"></i> Notopia CB</span>
      <button class="close-chatbot" id="close-chatbot">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="chatbox" id="chatbox">
      <div class="message bot-message">
        Hello! I'm here to help summarize your notes. What would you like to know?
      </div>
    </div>
    <div class="chat-input-container">
      <input type="text" id="user-input" class="chat-input" placeholder="Ask me something..." style="flex: 2; width: 80%; margin-right: 10px;" />
      <button class="send-btn" onclick="sendMessage()" style="border-radius: 50%; padding: 8px 12px; margin-right: 10px;">
        <i class="fas fa-paper-plane"></i>
      </button>
      <input type="file" id="file-upload" class="file-input" style="display: none;" onchange="uploadFile()" />
      <button onclick="document.getElementById('file-upload').click()">Upload Note</button>
      <button class="send-btn" onclick="document.getElementById('note-file').click()" style="border-radius: 50%; padding: 8px 12px;">
        <i class="fas fa-upload"></i>
      </button>
    </div>
  </div>
  <script>
    // Theme management
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    updateThemeIcon();
    
    document.getElementById('theme-toggle').addEventListener('click', () => {
      const current = document.documentElement.getAttribute('data-theme');
      const next = current === 'light' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      updateThemeIcon();
    });
    
    function updateThemeIcon() {
      const icon = document.getElementById('theme-toggle');
      const theme = document.documentElement.getAttribute('data-theme');
      icon.innerHTML = theme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    }
    
    // Show subject panel
function openSubject(subjectName, courseCode, credits) {
  currentSubject = subjectName.toLowerCase();

  const role = localStorage.getItem("role") || "student";
  document.getElementById("upload-area").style.display = (role === "teacher") ? "block" : "none";

  document.getElementById('subject-title').innerText = subjectName;
  document.getElementById('course-code').innerText = courseCode;
  document.getElementById('course-credits').innerText = credits;
  document.getElementById('subject-container').style.display = 'block';

  loadNotes(currentSubject);
}

    
    // Close subject panel
    function closeSubject() {
      document.getElementById('subject-container').style.display = 'none';
    }
    
    // Load notes from backend
    async function loadNotes(subject) {
  try {
    const response = await fetch(`http://localhost:5000/notes/${subject.toLowerCase()}`);
    const notes = await response.json();

    console.log("Loading notes for:", subject);
    console.log("Received notes:", notes);

    const list = document.getElementById('note-list');
    list.innerHTML = '';
    const role = localStorage.getItem("role") || "student";

    notes.forEach(note => {
  const item = document.createElement('div');
  item.className = 'note-item';

  const extension = note.filename.split('.').pop().toLowerCase();
  let iconClass = 'fas fa-file';
  if (extension === 'pdf') iconClass = 'fas fa-file-pdf';
  else if (['doc', 'docx'].includes(extension)) iconClass = 'fas fa-file-word';
  else if (['ppt', 'pptx'].includes(extension)) iconClass = 'fas fa-file-powerpoint';

  item.innerHTML = `
    <div class="note-info">
      <i class="${iconClass} note-icon"></i>
      <div>
        <div><a href="http://localhost:5000/file/${note._id}" target="_blank" style="text-decoration:none; color:inherit;">${note.filename}</a></div>
        <small>Uploaded: ${new Date(note.uploadDate).toLocaleString()}</small>
      </div>
    </div>
    <div class="note-actions">
      <a href="http://localhost:5000/file/${note._id}" class="note-btn" download>
        <i class="fas fa-download"></i> Download
      </a>
      <button class="note-btn" onclick="sendNoteToChatbot('${note.filename}')">
        <i class="fas fa-robot"></i> Send to Chatbot
      </button>
      ${role === 'teacher' ? `
        <button class="note-btn" onclick="deleteNote('${note._id}', '${subject}')">
          <i class="fas fa-trash"></i> Delete
        </button>
      ` : ''}
    </div>
  `;

  list.appendChild(item);
});


  } catch (err) {
    console.error('Error loading notes:', err);
  }
}

//upload    
async function uploadNote() {
  console.log("ðŸ“¤ uploadNote() triggered");

  const fileInput = document.getElementById('note-file');
  const file = fileInput.files[0];
  if (!file || !currentSubject) {
    console.warn("Missing file or subject:", file, currentSubject);
    return;
  }

  const formData = new FormData();
  formData.append('note', file);
  formData.append('subject', currentSubject.toLowerCase());

  try {
  const response = await fetch('http://localhost:5000/upload', {
    method: 'POST',
    body: formData
  });

  const result = await response.json();
  console.log("Upload response:", result); // âœ… Now added

  if (result.success) {
    alert(`âœ… File "${file.name}" uploaded successfully.`);
    console.log("Calling loadNotes with subject:", currentSubject);
    loadNotes(currentSubject);
  } else {
    alert('âŒ Upload failed.');
  }
} catch (err) {
  console.error("Upload error:", err);
  alert('ðŸš« Error uploading file.');
}


  fileInput.value = ""; // Reset input
}

    
    // Delete note
    async function deleteNote(fileId, subject) {
      const confirmed = confirm("Are you sure you want to delete this file?");
      if (!confirmed) return;
    
      try {
        const res = await fetch(`http://localhost:5000/file/${fileId}`, {
          method: 'DELETE'
        });
        const result = await res.json();
        if (result.success) {
          alert("Deleted successfully");
          loadNotes(subject);
        } else {
          alert("Delete failed");
        }
      } catch (err) {
        console.error(err);
        alert("Error deleting file");
      }
    }
    
    // Logout
    function logout() {
      localStorage.clear();
      window.location.href = "index.html";
    }
    
    // Chatbot toggle
    document.getElementById('toggle-chatbot').addEventListener('click', toggleChatbot);
    document.getElementById('chatbot-toggle-nav').addEventListener('click', toggleChatbot);
    document.getElementById('close-chatbot').addEventListener('click', closeChatbot);
    
    function toggleChatbot() {
      document.getElementById('chatbot-panel').classList.toggle('open');
    }
    function closeChatbot() {
      document.getElementById('chatbot-panel').classList.remove('open');
    }
    
    // Chatbot send
    function sendMessage() {
  const input = document.getElementById("user-input");
  const message = input.value.trim();
  if (!message) return;

  const chatbox = document.getElementById("chatbox");
  const userMessage = document.createElement("div");
  userMessage.className = "message user-message";
  userMessage.textContent = message;
  chatbox.appendChild(userMessage);
  input.value = "";

  // Update fetch call for OpenAI API
  fetch("http://localhost:5000/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message })
  })
  .then(res => res.json())
  .then(data => {
    const botMessage = document.createElement("div");
    botMessage.className = "message bot-message";
    botMessage.textContent = data.response || "No response received.";
    chatbox.appendChild(botMessage);
    chatbox.scrollTop = chatbox.scrollHeight;
  })
  .catch(err => {
    console.error("Chatbot error:", err);
  });
}

    
    document.getElementById('user-input').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') sendMessage();
    });
    
    // Load role on startup
    document.getElementById('user-role').innerText = localStorage.getItem('role') || 'Student';
    </script>
    <script src="dashboard.js"></script> 

    <script>
      const driveMap = {
        "software": "https://drive.google.com/drive/folders/14JJKG2_fnbaibJ2C798KliTkvSM5P71E",
        "principles of programming language": "https://drive.google.com/drive/folders/1kJCELq9imz1dCB32RawvlwBe6EAuzsCS",
        "computer security": "https://drive.google.com/drive/folders/1n4GjB2WwCeuggQxuZGXfqoNry4Zg_8wn",
        "distributed systems": "https://drive.google.com/drive/folders/1n0aKr0y7eZQ5B3vHcstQT5ds9xfSrqX8",
        "ethical hacking": "https://drive.google.com/drive/folders/12cQBW6GF9V6w9PjuBAgFeTj3T6q6rSze",
        "deep learning and computer vision": "https://drive.google.com/drive/folders/1cz_ksdX7uA_3W4VpAZbcXMMDvFAsVdE-",
        "cloud computing": "https://drive.google.com/drive/folders/1WThFzpQwbnMdWGleJ2HvzBFWBIGHAXBp",
        "mobile wireless": "https://drive.google.com/drive/folders/1Y1XylMXVEAp-Zav2tBo708zbHH7Q8jLS",
        "internet of things": "https://drive.google.com/drive/folders/1JIArzFHhDUZQsGB-8QCJ-4jdTq18R6mG",
        "neural networks": "https://drive.google.com/drive/folders/1SEDWFyAhmP0168NRGSJYRU1hXsJ-w8KF",
        "time series analysis": "https://drive.google.com/drive/folders/1JwqtEL8QVMTiNuxjD4lbhQQBBanjzvqU"
      };
      
      function openSubject(subjectName, courseCode, credits) {
        currentSubject = subjectName.toLowerCase();
        const role = localStorage.getItem("role") || "student";
      
        document.getElementById('subject-title').innerText = subjectName;
        document.getElementById('course-code').innerText = courseCode;
        document.getElementById('course-credits').innerText = credits;
        document.getElementById('subject-container').style.display = 'block';
        
        const driveLink = driveMap[currentSubject];
        const list = document.getElementById('note-list');
        list.innerHTML = '';
      
        if (!driveLink) {
          list.innerHTML = "<p style='color:red;'>No folder linked for this subject.</p>";
          return;
        }
      
        if (role === "teacher") {
  document.getElementById("upload-area").style.display = "block";
  const link = driveMap[currentSubject];
  document.getElementById("open-drive").href = link;
}
 else {
          document.getElementById("upload-area").style.display = "none";
        }
      
        list.innerHTML = `
          <div class="note-item">
            <div class="note-info">
              <i class="fas fa-folder-open note-icon"></i>
              <div><strong>Notes available in Google Drive</strong></div>
            </div>
            <div class="note-actions">
              <a class="note-btn" href="${driveLink}" target="_blank">
                <i class="fas fa-eye"></i> View Folder
              </a>
            </div>
          </div>
        `;

        // Auto-scroll to the subject container
        document.getElementById('subject-container').scrollIntoView({
          behavior: 'smooth'
        });
      }
      
      function logout() {
        localStorage.clear();
        window.location.href = "index.html";
      }
      </script>
      
      <script src="dashboard.js"></script>
</body>
</html>
